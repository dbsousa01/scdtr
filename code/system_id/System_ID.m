clear; close all; clc;

values = [10.00,0;
27.00,1;
53.20,2;
81.20,3;
108.00,4;
132.00,5;
152.80,6;
171.00,7;
188.40,8;
203.20,9;
217.60,10;
230.20,11;
242.60,12;
254.00,13;
265.00,14;
275.20,15;
285.20,16;
294.20,17;
303.40,18;
311.80,19;
320.20,20;
328.20,21;
335.60,22;
342.80,23;
350.20,24;
356.80,25;
363.40,26;
369.40,27;
375.60,28;
381.40,29;
387.40,30;
392.80,31;
398.60,32;
403.20,33;
408.60,34;
413.40,35;
418.40,36;
423.60,37;
428.20,38;
432.60,39;
437.20,40;
441.40,41;
445.20,42;
449.40,43;
454.00,44;
457.40,45;
461.00,46;
464.60,47;
468.60,48;
472.20,49;
475.40,50;
479.00,51;
482.40,52;
485.60,53;
488.80,54;
492.40,55;
495.00,56;
497.80,57;
501.00,58;
504.00,59;
506.60,60;
509.80,61;
512.40,62;
515.40,63;
518.00,64;
520.40,65;
523.40,66;
525.40,67;
528.40,68;
531.40,69;
533.60,70;
535.80,71;
538.40,72;
540.40,73;
542.60,74;
544.80,75;
547.40,76;
549.40,77;
551.80,78;
553.60,79;
555.60,80;
558.00,81;
559.80,82;
562.40,83;
563.80,84;
565.60,85;
568.00,86;
569.80,87;
571.80,88;
574.00,89;
575.60,90;
576.80,91;
579.00,92;
581.20,93;
582.20,94;
584.40,95;
585.60,96;
587.40,97;
589.40,98;
590.80,99;
593.00,100;
593.80,101;
595.60,102;
597.20,103;
598.20,104;
600.20,105;
601.80,106;
603.40,107;
605.20,108;
606.20,109;
607.60,110;
608.80,111;
609.80,112;
611.80,113;
613.00,114;
614.60,115;
616.00,116;
617.40,117;
619.20,118;
619.80,119;
621.20,120;
621.80,121;
623.80,122;
624.80,123;
626.00,124;
627.40,125;
628.20,126;
630.20,127;
631.40,128;
632.60,129;
633.60,130;
635.00,131;
635.60,132;
636.80,133;
638.20,134;
639.00,135;
640.00,136;
641.40,137;
642.00,138;
643.60,139;
644.40,140;
645.60,141;
646.80,142;
647.60,143;
649.00,144;
650.40,145;
651.40,146;
652.40,147;
653.00,148;
653.80,149;
655.20,150;
655.60,151;
657.20,152;
657.60,153;
659.00,154;
659.80,155;
660.60,156;
661.80,157;
662.60,158;
663.60,159;
664.80,160;
665.00,161;
666.20,162;
667.40,163;
667.80,164;
669.00,165;
669.60,166;
670.60,167;
671.80,168;
672.20,169;
673.20,170;
673.60,171;
675.60,172;
675.80,173;
676.20,174;
677.60,175;
678.40,176;
679.40,177;
679.80,178;
680.40,179;
681.00,180;
681.80,181;
683.20,182;
683.80,183;
684.40,184;
684.60,185;
685.40,186;
686.60,187;
687.60,188;
688.00,189;
688.80,190;
689.60,191;
690.40,192;
691.20,193;
691.40,194;
692.20,195;
692.80,196;
693.60,197;
694.60,198;
695.20,199;
695.60,200;
696.40,201;
697.60,202;
697.80,203;
698.60,204;
699.60,205;
700.00,206;
701.00,207;
701.00,208;
702.00,209;
702.60,210;
702.80,211;
703.80,212;
704.00,213;
704.80,214;
705.80,215;
705.80,216;
707.00,217;
707.80,218;
708.00,219;
708.60,220;
709.20,221;
710.00,222;
710.80,223;
711.00,224;
712.00,225;
712.00,226;
712.80,227;
713.20,228;
714.00,229;
714.80,230;
715.40,231;
716.20,232;
716.20,233;
716.60,234;
717.60,235;
717.80,236;
718.60,237;
719.00,238;
719.60,239;
720.40,240;
720.60,241;
721.00,242;
721.20,243;
721.60,244;
722.40,245;
723.40,246;
724.00,247;
724.20,248;
724.80,249;
725.40,250;
726.00,251;
726.40,252;
727.00,253;
727.20,254;
728.00,255;
];


AR = values(:,1);
PWM = values(:,2);

vldr = 5-(AR.*5./1023);

R1 = 10;
m = -0.692;
b = 1.808;

f = R1*(5-((AR.*5)./(1023)))./((AR.*5)./(1023));
lux = 10.^((log10(f)-b)/m);

%t = linspace(0,2.5,length(PWM))';

lux_values = polyfit(PWM,lux,1);
lux_m = lux_values(1,1);
lux_b = lux_values(1,2);

figure
plot(PWM)
title('PWM stair')
figure
plot(PWM,AR)
title('Values from Arduino Analog Read')
figure
plot(PWM,lux);
title('Lux values computed')
